{"title":"elasticsearch scripting module","uid":"395e80b0d84ad157141ca4de3ba9bafc","slug":"elasticsearch-scripting-module","date":"2020-06-17T14:43:56.000Z","updated":"2020-08-02T14:00:00.000Z","comments":true,"path":"api/articles/elasticsearch-scripting-module.json","keywords":null,"cover":"https://pic.nas.rodzrk.cn:28443/i/2023/10/24/653762cf95402.jpg","content":"<h1 id=\"ES脚本模块API兼容性问题\"><a href=\"#ES脚本模块API兼容性问题\" class=\"headerlink\" title=\"ES脚本模块API兼容性问题\"></a>ES脚本模块API兼容性问题</h1><p style=\"text-indent: 2em\">在ES的API中是支持脚本的,但是在早期的版本,部分的API版本变化相对比较频繁,因此在不同版本之间是可能存在兼容性问题的,这篇文章主要用于记录部分API的变化.</p>\n\n<span id=\"more\"></span>\n<p>注: 由于项目中仅用到了5.4.x和5.6.x版本的ES,因此该文章只记录了部分版本的变化.</p>\n<h2 id=\"一-Store-Scripts\"><a href=\"#一-Store-Scripts\" class=\"headerlink\" title=\"一. Store Scripts\"></a>一. Store Scripts</h2><p>可以使用_scripts端点将脚本存储在集群或者从集群中检索脚本.如果ES启用了安全功能,则必须拥有以下权限才能创建、检索或者删除存储的脚本。</p>\n<p>查看更多安全功能相关信息,请参阅 <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/master/security\" title=\"-privileges.html\" target=\"\">Security privileges</a></p>\n<h3 id=\"1-5-3-x-5-5-x\"><a href=\"#1-5-3-x-5-5-x\" class=\"headerlink\" title=\"1. 5.3.x-5.5.x\"></a>1. 5.3.x-5.5.x</h3><h4 id=\"1-1-存储脚本请求\"><a href=\"#1-1-存储脚本请求\" class=\"headerlink\" title=\"1.1 存储脚本请求\"></a>1.1 存储脚本请求</h4><div class=\"language-http\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">http</span><pre class=\"shiki github-light\" style=\"background-color: #f6f6f7\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #24292E\">/_scripts/&#123;id&#125;</span></span></code></pre></div><ul>\n<li>id在存储的脚本中是唯一的。</li>\n</ul>\n<p style=\"text-indent: 2em\">\n\n<p>如下是一个存储Painless脚本的示例，脚本名为 <code>calculate-store</code></p>\n</p>\n\n<div class=\"language-http\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">http</span><pre class=\"shiki github-light\" style=\"background-color: #f6f6f7\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #D73A49\">POST</span><span style=\"color: #24292E\"> _scripts/calculate-score</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">  </span><span style=\"color: #005CC5\">&quot;script&quot;</span><span style=\"color: #24292E\">: &#123;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">&quot;lang&quot;</span><span style=\"color: #24292E\">: </span><span style=\"color: #032F62\">&quot;painless&quot;</span><span style=\"color: #24292E\">,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">&quot;code&quot;</span><span style=\"color: #24292E\">: </span><span style=\"color: #032F62\">&quot;Math.log(_score * 2) + params.my_modifier&quot;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">&#125;</span></span></code></pre></div><h4 id=\"1-2-检索已创建的脚本\"><a href=\"#1-2-检索已创建的脚本\" class=\"headerlink\" title=\"1.2 检索已创建的脚本\"></a>1.2 检索已创建的脚本</h4><div class=\"language-http\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">http</span><pre class=\"shiki github-light\" style=\"background-color: #f6f6f7\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #D73A49\">GET</span><span style=\"color: #24292E\"> _scripts/calculate-score</span></span></code></pre></div><h4 id=\"1-3-使用存储的脚本\"><a href=\"#1-3-使用存储的脚本\" class=\"headerlink\" title=\"1.3 使用存储的脚本\"></a>1.3 使用存储的脚本</h4><div class=\"language-http\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">http</span><pre class=\"shiki github-light\" style=\"background-color: #f6f6f7\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #D73A49\">GET</span><span style=\"color: #24292E\"> _search</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">  </span><span style=\"color: #005CC5\">&quot;query&quot;</span><span style=\"color: #24292E\">: &#123;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">&quot;script&quot;</span><span style=\"color: #24292E\">: &#123;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">      </span><span style=\"color: #005CC5\">&quot;script&quot;</span><span style=\"color: #24292E\">: &#123;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #005CC5\">&quot;stored&quot;</span><span style=\"color: #24292E\">: </span><span style=\"color: #032F62\">&quot;calculate-score&quot;</span><span style=\"color: #24292E\">,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #005CC5\">&quot;params&quot;</span><span style=\"color: #24292E\">: &#123;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">          </span><span style=\"color: #005CC5\">&quot;my_modifier&quot;</span><span style=\"color: #24292E\">: </span><span style=\"color: #005CC5\">2</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        &#125;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">      &#125;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    &#125;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">&#125;</span></span></code></pre></div><h4 id=\"1-4-删除存储的脚本\"><a href=\"#1-4-删除存储的脚本\" class=\"headerlink\" title=\"1.4 删除存储的脚本\"></a>1.4 删除存储的脚本</h4><div class=\"language-http\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">http</span><pre class=\"shiki github-light\" style=\"background-color: #f6f6f7\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #D73A49\">DELETE</span><span style=\"color: #24292E\"> _scripts/calculate-score</span></span></code></pre></div><h3 id=\"2-5-6-x-6-0-x-6-8-x-7-0-x-7-3-x\"><a href=\"#2-5-6-x-6-0-x-6-8-x-7-0-x-7-3-x\" class=\"headerlink\" title=\"2. 5.6.x,6.0.x-6.8.x,7.0.x-7.3.x\"></a>2. 5.6.x,6.0.x-6.8.x,7.0.x-7.3.x</h3><h4 id=\"2-1-存储脚本请求\"><a href=\"#2-1-存储脚本请求\" class=\"headerlink\" title=\"2.1 存储脚本请求\"></a>2.1 存储脚本请求</h4><div class=\"language-http\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">http</span><pre class=\"shiki github-light\" style=\"background-color: #f6f6f7\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #24292E\">/_scripts/&#123;id&#125;</span></span></code></pre></div><ul>\n<li>id在存储的脚本中是唯一的。</li>\n</ul>\n<p style=\"text-indent: 2em\">\n\n<p>如下是一个存储Painless脚本的示例，脚本名为 <code>calculate-store</code></p>\n</p>\n\n<div class=\"language-http\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">http</span><pre class=\"shiki github-light\" style=\"background-color: #f6f6f7\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #D73A49\">POST</span><span style=\"color: #24292E\"> _scripts/calculate-score</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">  </span><span style=\"color: #005CC5\">&quot;script&quot;</span><span style=\"color: #24292E\">: &#123;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">&quot;lang&quot;</span><span style=\"color: #24292E\">: </span><span style=\"color: #032F62\">&quot;painless&quot;</span><span style=\"color: #24292E\">,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">&quot;source&quot;</span><span style=\"color: #24292E\">: </span><span style=\"color: #032F62\">&quot;Math.log(_score * 2) + params.my_modifier&quot;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">&#125;</span></span></code></pre></div><p><strong>注: 此处与之前的版本不同,发生了变化,<code>code</code>修改为了<code>source</code></strong></p>\n<h4 id=\"2-2-检索已创建的脚本\"><a href=\"#2-2-检索已创建的脚本\" class=\"headerlink\" title=\"2.2 检索已创建的脚本\"></a>2.2 检索已创建的脚本</h4><div class=\"language-http\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">http</span><pre class=\"shiki github-light\" style=\"background-color: #f6f6f7\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #D73A49\">GET</span><span style=\"color: #24292E\"> _scripts/calculate-score</span></span></code></pre></div><h4 id=\"2-3-使用存储的脚本\"><a href=\"#2-3-使用存储的脚本\" class=\"headerlink\" title=\"2.3 使用存储的脚本\"></a>2.3 使用存储的脚本</h4><div class=\"language-http\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">http</span><pre class=\"shiki github-light\" style=\"background-color: #f6f6f7\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #D73A49\">GET</span><span style=\"color: #24292E\"> _search</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">  </span><span style=\"color: #005CC5\">&quot;query&quot;</span><span style=\"color: #24292E\">: &#123;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">&quot;script&quot;</span><span style=\"color: #24292E\">: &#123;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">      </span><span style=\"color: #005CC5\">&quot;script&quot;</span><span style=\"color: #24292E\">: &#123;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #005CC5\">&quot;id&quot;</span><span style=\"color: #24292E\">: </span><span style=\"color: #032F62\">&quot;calculate-score&quot;</span><span style=\"color: #24292E\">,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #005CC5\">&quot;params&quot;</span><span style=\"color: #24292E\">: &#123;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">          </span><span style=\"color: #005CC5\">&quot;my_modifier&quot;</span><span style=\"color: #24292E\">: </span><span style=\"color: #005CC5\">2</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        &#125;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">      &#125;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    &#125;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">&#125;</span></span></code></pre></div><p><strong>注: 使用存储的脚本时API发生了变化,<code>stored</code>修改为了<code>id</code></strong></p>\n<h4 id=\"2-4-删除存储的脚本\"><a href=\"#2-4-删除存储的脚本\" class=\"headerlink\" title=\"2.4 删除存储的脚本\"></a>2.4 删除存储的脚本</h4><div class=\"language-http\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">http</span><pre class=\"shiki github-light\" style=\"background-color: #f6f6f7\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #D73A49\">DELETE</span><span style=\"color: #24292E\"> _scripts/calculate-score</span></span></code></pre></div><h2 id=\"参考文档\"><a href=\"#参考文档\" class=\"headerlink\" title=\"参考文档\"></a>参考文档</h2><a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/master/modules-scripting-using.html\" title=\"\" target=\"\">How to use scripts(master)</a>\n\n","text":"ES脚本模块API兼容性问题在ES的API中是支持脚本的,但是在早期的版本,部分的API版本变化相对比较频繁,因此在不同版本之间是可能存在兼容性问题的,这篇文章...","permalink":"/post/elasticsearch-scripting-module","photos":[],"count_time":{"symbolsCount":"1.8k","symbolsTime":"2 mins."},"categories":[{"name":"elasticsearch","slug":"elasticsearch","count":1,"path":"api/categories/elasticsearch.json"}],"tags":[{"name":"elasticsearch","slug":"elasticsearch","count":1,"path":"api/tags/elasticsearch.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#ES%E8%84%9A%E6%9C%AC%E6%A8%A1%E5%9D%97API%E5%85%BC%E5%AE%B9%E6%80%A7%E9%97%AE%E9%A2%98\"><span class=\"toc-text\">ES脚本模块API兼容性问题</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%B8%80-Store-Scripts\"><span class=\"toc-text\">一. Store Scripts</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#1-5-3-x-5-5-x\"><span class=\"toc-text\">1. 5.3.x-5.5.x</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#1-1-%E5%AD%98%E5%82%A8%E8%84%9A%E6%9C%AC%E8%AF%B7%E6%B1%82\"><span class=\"toc-text\">1.1 存储脚本请求</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#1-2-%E6%A3%80%E7%B4%A2%E5%B7%B2%E5%88%9B%E5%BB%BA%E7%9A%84%E8%84%9A%E6%9C%AC\"><span class=\"toc-text\">1.2 检索已创建的脚本</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#1-3-%E4%BD%BF%E7%94%A8%E5%AD%98%E5%82%A8%E7%9A%84%E8%84%9A%E6%9C%AC\"><span class=\"toc-text\">1.3 使用存储的脚本</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#1-4-%E5%88%A0%E9%99%A4%E5%AD%98%E5%82%A8%E7%9A%84%E8%84%9A%E6%9C%AC\"><span class=\"toc-text\">1.4 删除存储的脚本</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#2-5-6-x-6-0-x-6-8-x-7-0-x-7-3-x\"><span class=\"toc-text\">2. 5.6.x,6.0.x-6.8.x,7.0.x-7.3.x</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#2-1-%E5%AD%98%E5%82%A8%E8%84%9A%E6%9C%AC%E8%AF%B7%E6%B1%82\"><span class=\"toc-text\">2.1 存储脚本请求</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#2-2-%E6%A3%80%E7%B4%A2%E5%B7%B2%E5%88%9B%E5%BB%BA%E7%9A%84%E8%84%9A%E6%9C%AC\"><span class=\"toc-text\">2.2 检索已创建的脚本</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#2-3-%E4%BD%BF%E7%94%A8%E5%AD%98%E5%82%A8%E7%9A%84%E8%84%9A%E6%9C%AC\"><span class=\"toc-text\">2.3 使用存储的脚本</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#2-4-%E5%88%A0%E9%99%A4%E5%AD%98%E5%82%A8%E7%9A%84%E8%84%9A%E6%9C%AC\"><span class=\"toc-text\">2.4 删除存储的脚本</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3\"><span class=\"toc-text\">参考文档</span></a></li></ol></li></ol>","author":{"name":"Rod","slug":"blog-author","avatar":"https://cdn.jsdelivr.net/gh/rodzrk/PicGoRepo/img/202310240007987.jpg","link":"/","description":"","socials":{"github":"https://github.com/rodzrk","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{},"next_post":{"title":"JanusGraph Index Problem","uid":"eca93a4fc619ef446eb6c515e09fb668","slug":"janusgraph-index-problem","date":"2020-06-14T06:00:00.000Z","updated":"2023-10-24T07:11:56.414Z","comments":true,"path":"api/articles/janusgraph-index-problem.json","keywords":null,"cover":"https://pic.nas.rodzrk.cn:28443/i/2023/10/24/653767f47d9d9.png","text":"JanusGraph索引问题整理一. 解决JanusGraph索引更新失败导致数据不一致的场景JanusGraph 虽然可以支持事务,但其原子性仅保证了更新存储...","permalink":"/post/janusgraph-index-problem","photos":[],"count_time":{"symbolsCount":"26k","symbolsTime":"24 mins."},"categories":[{"name":"janusgraph","slug":"janusgraph","count":1,"path":"api/categories/janusgraph.json"},{"name":"index","slug":"janusgraph/index","count":1,"path":"api/categories/janusgraph/index.json"}],"tags":[{"name":"janusgraph","slug":"janusgraph","count":1,"path":"api/tags/janusgraph.json"},{"name":"index","slug":"index","count":1,"path":"api/tags/index.json"}],"author":{"name":"Rod","slug":"blog-author","avatar":"https://cdn.jsdelivr.net/gh/rodzrk/PicGoRepo/img/202310240007987.jpg","link":"/","description":"","socials":{"github":"https://github.com/rodzrk","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}